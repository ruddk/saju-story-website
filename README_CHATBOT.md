# 수목선생의 사주이야기 - RAG + LangChain 챗봇

## 🚀 기능 소개

메인 페이지에 추가된 AI 챗봇은 다음과 같은 기능을 제공합니다:

### 🤖 챗봇 기능
- **실시간 상담**: 사주 상담 관련 질문에 대한 즉시 답변
- **예약 관리**: 상담 예약 가능 여부 확인 및 예약 처리
- **지식 베이스**: RAG(Retrieval-Augmented Generation)를 통한 정확한 정보 제공
- **대화 기억**: 이전 대화 내용을 기억하여 연속적인 상담 가능

### 📋 주요 기능
1. **상담 가능 여부 확인**
   - 실시간 예약 현황 조회
   - 가능한 날짜와 시간 안내
   - 월요일 휴무 등 운영 정보 제공

2. **예약 시스템**
   - 이름, 연락처, 날짜, 시간 입력
   - 중복 예약 방지
   - 예약 확인 및 변경 안내

3. **정보 제공**
   - 상담 비용 및 시간 안내
   - 위치 및 교통편 정보
   - 상담 준비사항 안내

## 🛠️ 설치 방법

### 1. 필요한 패키지 설치
```bash
# conda 환경 활성화
conda activate k1

# 필요한 패키지 설치
pip install -r requirements.txt
```

### 2. 환경 변수 설정
프로젝트 루트에 `.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
# OpenAI API 설정
OPENAI_API_KEY=your_openai_api_key_here

# Flask 설정
FLASK_ENV=development
FLASK_DEBUG=True
```

**⚠️ 중요**: `your_openai_api_key_here` 부분을 실제 OpenAI API 키로 교체하세요.

### 3. OpenAI API 키 발급
1. [OpenAI 웹사이트](https://platform.openai.com/)에 가입
2. API Keys 섹션에서 새 API 키 생성
3. 생성된 키를 `.env` 파일에 입력

## 🚀 실행 방법

### 1. 서버 실행
```bash
# 프로젝트 디렉토리로 이동
cd "24.수목선생의 사주이야기"

# Flask 서버 실행
python app.py
```

### 2. 웹사이트 접속
브라우저에서 `http://localhost:5002`로 접속

### 3. 챗봇 사용
- 메인 페이지 우측 하단의 "상담 문의" 버튼 클릭
- 챗봇 창이 열리면 메시지 입력
- 예약 관련 질문 시 자동으로 예약 프로세스 안내

## 💬 챗봇 사용 예시

### 기본 질문
```
사용자: "상담 비용이 얼마인가요?"
챗봇: "60분 상담은 50,000원입니다. 상담 방법은 방문 상담, 전화 상담, 영상 상담이 가능합니다."

사용자: "영업시간이 어떻게 되나요?"
챗봇: "화요일-일요일 10:00-19:00에 운영하며, 월요일은 휴무입니다. 점심시간은 12:00-13:00입니다."
```

### 예약 관련
```
사용자: "예약하고 싶어요"
챗봇: "안녕하세요! 예약을 도와드리겠습니다. 현재 예약 가능한 시간은 다음과 같습니다:
[오늘부터 7일간의 가능한 시간 표시]
원하시는 날짜와 시간을 알려주세요."

사용자: "내일 오후 2시에 예약하고 싶어요"
챗봇: "내일 오후 2시 예약을 확인해드리겠습니다. 예약을 완료하기 위해 이름과 연락처가 필요합니다."
```

## 🔧 기술 스택

### Backend
- **Flask**: 웹 프레임워크
- **LangChain**: AI 체인 관리
- **OpenAI GPT-3.5-turbo**: 대화 모델
- **FAISS**: 벡터 데이터베이스
- **Sentence Transformers**: 텍스트 임베딩

### Frontend
- **HTML5/CSS3**: 챗봇 UI
- **JavaScript (ES6+)**: 챗봇 인터랙션
- **Fetch API**: 서버 통신

### 데이터 관리
- **JSON**: 예약 데이터 저장
- **LocalStorage**: 사용자 정보 저장

## 📁 파일 구조

```
24.수목선생의 사주이야기/
├── chatbot.py              # 챗봇 핵심 로직
├── app.py                  # Flask 앱 (챗봇 API 추가)
├── requirements.txt        # 필요한 패키지 목록
├── .env                    # 환경 변수 (사용자 생성 필요)
├── data/                   # 예약 데이터 저장소
│   └── reservations.json   # 예약 정보
├── templates/
│   └── main.html          # 메인 페이지 (챗봇 UI 추가)
└── static/
    ├── css/
    │   └── main.css       # 챗봇 스타일 추가
    └── js/
        └── chatbot.js     # 챗봇 JavaScript
```

## 🔍 주요 API 엔드포인트

### 1. 챗봇 대화
```
POST /api/chat
Content-Type: application/json

{
    "message": "사용자 메시지",
    "user_info": {
        "name": "사용자 이름",
        "phone": "연락처"
    }
}
```

### 2. 예약 가능 시간 조회
```
GET /api/available-times?date=2024-01-15
```

### 3. 예약 생성
```
POST /api/make-reservation
Content-Type: application/json

{
    "name": "이름",
    "phone": "연락처",
    "date": "2024-01-15",
    "time": "14:00",
    "consultation_type": "방문 상담"
}
```

## 🎯 챗봇 지식 베이스

챗봇은 다음 정보를 포함한 지식 베이스를 보유합니다:

- **상담 서비스**: 비용, 시간, 방법
- **예약 안내**: 예약 방법, 변경/취소 정책
- **상담 준비사항**: 필요한 정보, 준비물
- **위치 안내**: 주소, 교통편, 주차
- **연락처**: 전화, 이메일, 카카오톡

## 🔧 커스터마이징

### 지식 베이스 수정
`chatbot.py`의 `_initialize_vectorstore()` 메서드에서 `knowledge_base` 변수를 수정하여 챗봇의 지식을 업데이트할 수 있습니다.

### 예약 시간 조정
`chatbot.py`의 `available_hours` 딕셔너리를 수정하여 상담 가능 시간을 조정할 수 있습니다.

### UI 스타일 변경
`static/css/main.css`의 챗봇 관련 CSS를 수정하여 디자인을 변경할 수 있습니다.

## 🚨 주의사항

1. **API 키 보안**: `.env` 파일을 Git에 커밋하지 마세요
2. **데이터 백업**: `data/reservations.json` 파일을 정기적으로 백업하세요
3. **서버 리소스**: 챗봇은 메모리를 사용하므로 서버 사양을 고려하세요

## 🆘 문제 해결

### 챗봇이 응답하지 않는 경우
1. OpenAI API 키가 올바른지 확인
2. 인터넷 연결 상태 확인
3. Flask 서버가 정상 실행 중인지 확인

### 예약 데이터가 저장되지 않는 경우
1. `data` 폴더가 존재하는지 확인
2. 파일 권한 확인
3. JSON 파일 형식 확인

## 📞 지원

문제가 발생하거나 추가 기능이 필요한 경우 개발팀에 문의하세요.
